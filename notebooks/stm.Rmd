---
title: "Navigo Topic Model"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Load dataset

```{r}
library(dplyr)

reddit_waze_path <- file.path(getwd(), "../raw/raw_textonly_waze.json")
reddit_waze_raw <- read_json(reddit_waze_path, simplifyVector = TRUE)
```

## Tidy Text

```{r}
reddit_waze_tidy <- reddit_waze_raw %>% 
  replace_with_na_all(condition = ~.x %in% common_na_strings) %>% 
  replace_with_na_all(condition = ~.x == "[deleted]") %>% 
  drop_na(body)

library(tidytext)

reddit_waze_tidy <- reddit_waze_tidy %>% 
  unnest_tokens(word, title_key, token = "words") %>% 
  anti_join(get_stopwords()) %>% 
  filter(!str_detect(word, "[0-9]+")) %>% 
  add_count(word) %>% 
  filter(n > 100) %>% 
  select(-n)

leiden_sparse_community <- leiden_tidy %>% 
  count(community, word) %>% 
  cast_sparse(community, word, n)

leiden_sparse_article <- leiden_tidy %>% 
  count(eid, word) %>% 
  cast_sparse(eid, word, n)
```

